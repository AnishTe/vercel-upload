(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[307],{8832:(e,t,a)=>{Promise.resolve().then(a.bind(a,8209))},8209:(e,t,a)=>{"use strict";a.d(t,{default:()=>F});var r=a(5155),s=a(2115),n=a(7594),l=a(853),i=a(1902),c=a(1719),o=a(960),d=a(830),m=a(9606),u=a(3415),h=a(2679),N=a(3312),x=a(9749),y=a(4870),g=a(3900),p=a(3404),A=a(3092),f=a(5147),j=a(5765);let T=e=>[{id:"COCD",accessorKey:"COCD",header:"COCD"},{id:"VOUCHERDATE",accessorKey:"VOUCHERDATE",header:"Date",cell:e=>{let{row:t}=e,a=new Date(t.original.VOUCHERDATE);return(0,r.jsx)("span",{className:"truncate ",children:a.toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"2-digit"})})}},{id:"NARRATION",accessorKey:"NARRATION",header:"Narration",cell:e=>{let{row:t}=e;return(0,r.jsx)("div",{className:"max-w-[500px] min-w-[200px] whitespace-normal break-words",title:t.original.NARRATION,children:t.original.NARRATION})}},{id:"OpeningBalance",header:"Opening Balance",cell:e=>{let{row:t}=e;return(0,r.jsx)("span",{children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(t.original.OpeningBalance)})}},{id:"Amount",header:"Amount",cell:t=>{let{row:a}=t;return(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(a.original.Amount)}),"BILL"===a.original.CTRCODE&&(0,r.jsx)("button",{type:"button",title:"Open details",className:"text-blue-500 hover:text-blue-700",onClick:()=>e(a.original),children:(0,r.jsx)(j.A,{className:"h-4 w-4"})})]})}},{id:"ClosingBalance",header:"Closing Balance",cell:e=>{let{row:t}=e,a=t.original.ClosingBalance,s=a<0;return(0,r.jsx)("span",{style:{color:s?"red":"inherit"},children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(a)})}}],w=[{accessorKey:"SCRIP_SYMBOL",header:"Scrip Symbol",cell:e=>{let{row:t}=e;return t.original.SCRIP_SYMBOL}},{accessorKey:"open_QUANTITY",header:"Open Quantity",cell:e=>{let{row:t}=e;return t.original.open_QUANTITY}},{accessorKey:"Open_AMOUNT",header:"Open Amount",cell:e=>{let{row:t}=e;return t.original.Open_AMOUNT}},{accessorKey:"BUY_QUANTITY",header:"Buy Quantity",cell:e=>{let{row:t}=e;return t.original.BUY_QUANTITY}},{accessorKey:"BUY_RATE",header:"Buy Rate",cell:e=>{let{row:t}=e;return t.original.BUY_RATE}},{accessorKey:"BUY_AMOUNT",header:"Buy Amount",cell:e=>{let{row:t}=e;return t.original.BUY_AMOUNT}},{accessorKey:"SALE_QUANTITY",header:"Sale Quantity",cell:e=>{let{row:t}=e;return t.original.SALE_QUANTITY}},{accessorKey:"SALE_RATE",header:"Sale Rate",cell:e=>{let{row:t}=e;return t.original.SALE_RATE}},{accessorKey:"SALE_AMOUNT",header:"Sale Amount",cell:e=>{let{row:t}=e;return t.original.SALE_AMOUNT}},{accessorKey:"NET_QUANTITY",header:"Net Quantity",cell:e=>{let{row:t}=e;return t.original.NET_QUANTITY}},{accessorKey:"NET_RATE",header:"Net Rate",cell:e=>{let{row:t}=e;return t.original.NET_RATE}},{accessorKey:"NET_AMOUNT",header:"Net Amount",cell:e=>{let{row:t}=e;return t.original.NET_AMOUNT}}];var E=a(7081),D=a(1541),b=a(1344),O=a(6323),R=a(7328),I=a(532),C=a(1567);let S=I.bL,M=I.l9;I.Mz;let _=s.forwardRef((e,t)=>{let{className:a,align:s="center",sideOffset:n=4,...l}=e;return(0,r.jsx)(I.ZL,{children:(0,r.jsx)(I.UC,{ref:t,align:s,sideOffset:n,className:(0,C.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});_.displayName=I.UC.displayName;var B=a(8986);function F(){let[e,t]=(0,s.useState)(!1),[a,j]=(0,s.useState)(null),[I,C]=(0,s.useState)(!1),[F,U]=(0,s.useState)(null),[v,L]=(0,s.useState)([]),[Y,K]=(0,s.useState)([]),[P,k]=(0,s.useState)(!1),[G,z]=(0,s.useState)(!1),[Q,J]=(0,s.useState)(!1),V=async e=>{C(!0),J(!0);let t=(0,o.GP)(new Date(e.BILL_DATE),"dd/MM/yyyy");try{let a=await (0,O.oV)({toDate:t,mktType:e.MKT_TYPE,SETLNO:e.SETTLEMENT_NO});if(!(0,R.k)(a)){k(!0);return}let r=JSON.parse(a.data.data);if("True"===r.Success&&r["Success Description"])L(r["Success Description"]);else throw Error(r["Error Description"]||"Failed to fetch ledger data.")}catch(e){U(e.message||"An error occurred while fetching data.")}finally{C(!1)}},{fromDate:q,toDate:H}=(()=>{let e=new Date,t=e.getUTCFullYear(),a=3>e.getUTCMonth()?new Date(t-1,3,1):new Date(t,3,1),r=new Date(a.getUTCFullYear()+1,2,31);return{fromDate:(0,o.GP)(a,"yyyy-MM-dd"),toDate:(0,o.GP)(r,"yyyy-MM-dd")}})(),Z=u.Ik({fromDate:u.Yj().nonempty("From Date is required"),toDate:u.Yj().nonempty("To Date is required")}),$=(0,m.mN)({resolver:(0,h.u)(Z),defaultValues:{fromDate:q,toDate:H}}),X=async(e,a)=>{t(!0);try{let t=await (0,O.j3)({fromDate:(0,o.GP)((0,d.qg)(e,"yyyy-MM-dd",new Date),"dd/MM/yyyy"),toDate:(0,o.GP)((0,d.qg)(a,"yyyy-MM-dd",new Date),"dd/MM/yyyy")});if(!(0,R.k)(t)){k(!0);return}let r=JSON.parse(t.data.data);if("True"===r.Success&&r["Success Description"])K(r["Success Description"]);else throw Error(r["Error Description"]||"Failed to fetch ledger data.")}catch(e){j(e.message||"An error occurred while fetching data.")}finally{t(!1)}};(0,s.useEffect)(()=>{X(q,H)},[q,H]);let W=(0,s.useMemo)(()=>v.filter(e=>"EXPENSES"===e.company_code||"BROKERAGE"===e.company_code),[v]),ee=(0,s.useMemo)(()=>{let e=[],t={transactionCharges:0,gst:0};return W.forEach(a=>{let r=Math.abs(Number(a.NET_AMOUNT));switch(a.SCRIPDATACOL){case"ACCOUNT732":e.push({label:"SEBI FEES",amount:r});break;case"BRK":e.push({label:"Brokerage",amount:r});break;case"DEF4NSE":case"DEF4BSE":t.transactionCharges+=r;break;case"CGST":case"SGST":t.gst+=r;break;default:e.push({label:a.SCRIPDATACOL,amount:r})}}),t.transactionCharges>0&&e.push({label:"Transaction Charges",amount:t.transactionCharges}),t.gst>0&&e.push({label:"GST",amount:t.gst}),e},[W]);console.log(W);let et=(0,s.useMemo)(()=>v.filter(e=>"EXPENSES"!==e.company_code&&"BROKERAGE"!==e.company_code),[v]),ea=(0,s.useMemo)(()=>Y.filter(e=>"OPENING BALANCE"===e.NARRATION),[Y]),er=(0,s.useMemo)(()=>Y.filter(e=>"OPENING BALANCE"!==e.NARRATION&&"ASSOCIATE OPENING BALANCE"!==e.NARRATION),[Y]),es=(0,s.useMemo)(()=>ea.reduce((e,t)=>e+(t.CR_AMT-t.DR_AMT),0),[ea]),en=(0,s.useMemo)(()=>ea.reduce((e,t)=>e+(t.CR_AMT-t.DR_AMT),0),[ea]),el=(0,s.useMemo)(()=>{let e=en;return er.map(t=>{let a=t.CR_AMT-t.DR_AMT,r=e+a,s={...t,OpeningBalance:e,Amount:a,ClosingBalance:r};return e=r,s})},[er,en]),ei=(0,s.useMemo)(()=>Q?W.reduce((e,t)=>e+(Number(t.NOT_PROFIT)||0),0):0,[Q,W]),ec=(0,s.useMemo)(()=>Q?et.reduce((e,t)=>e+parseFloat(t.NET_AMOUNT||0),0):0,[Q,et]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.A,{children:(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)(x.Zp,{children:[(0,r.jsxs)(x.aR,{className:"flex flex-row items-center justify-between",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(x.ZB,{children:"Ledger Book"})}),(0,r.jsx)("div",{className:"flex-shrink-0 m-0",children:(0,r.jsx)(y.lV,{...$,children:(0,r.jsxs)("form",{onSubmit:$.handleSubmit(e=>{X(e.fromDate,e.toDate)}),className:"flex flex-col sm:flex-row sm:gap-3 items-center w-full",children:[(0,r.jsx)(y.zB,{control:$.control,name:"fromDate",render:e=>{let{field:t}=e;return(0,r.jsxs)(y.eI,{className:"space-y-0 w-full sm:w-auto",children:[(0,r.jsx)(B.J,{htmlFor:"fromDate",className:"sr-only",children:"From Date"}),(0,r.jsx)(y.MJ,{children:(0,r.jsx)(g.p,{type:"date",id:"fromDate",className:"h-10 rounded-md border text-white bg-transparent px-3 py-2 text-sm w-full sm:w-auto",...t})}),(0,r.jsx)(y.C5,{})]})}}),(0,r.jsx)(y.zB,{control:$.control,name:"toDate",render:e=>{let{field:t}=e;return(0,r.jsxs)(y.eI,{className:"space-y-0 w-full sm:w-auto",children:[(0,r.jsx)(B.J,{htmlFor:"toDate",className:"sr-only",children:"To Date"}),(0,r.jsx)(y.MJ,{children:(0,r.jsx)(g.p,{type:"date",id:"toDate",className:"h-10 rounded-md border text-white bg-transparent px-3 py-2 text-sm w-full sm:w-auto",...t})}),(0,r.jsx)(y.C5,{})]})}}),(0,r.jsx)(N.$,{type:"submit",disabled:e,className:"mt-2 sm:mt-0",children:e?(0,r.jsx)(n.A,{className:"h-5 w-5"}):(0,r.jsx)(l.A,{className:"h-5 w-5"})})]})})})]}),(0,r.jsxs)(x.Wu,{children:[e?(0,r.jsx)(E.E,{className:"h-8 w-full"}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex justify-center items-center gap-6 m-2",children:[(0,r.jsx)("span",{className:"font-[400]",children:"Opening Balance Total:"}),(0,r.jsx)("span",{className:"font-semibold",children:(0,r.jsx)(D.A,{animateOn:"view",revealDirection:"center",characters:"123456789",text:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2,minimumFractionDigits:2}).format(es)})}),(0,r.jsxs)(S,{children:[(0,r.jsx)(M,{asChild:!0,children:(0,r.jsx)(N.$,{variant:"ghost",size:"sm",children:G?(0,r.jsx)(i.A,{size:8}):(0,r.jsx)(c.A,{size:8})})}),(0,r.jsx)(_,{align:"center",side:"bottom",className:"w-[320px] p-4 bg-white shadow-lg border border-gray-200 rounded-lg",children:(0,r.jsx)("div",{className:"space-y-2",children:ea.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-between items-center p-2",children:[(0,r.jsx)("span",{className:"text-sm ",children:e.COCD}),(0,r.jsx)("span",{className:"text-sm ",children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(e.CR_AMT-e.DR_AMT)})]},t))})})]})]})}),e?(0,r.jsx)(f.A,{columns:4,rows:10}):a?(0,r.jsx)("h3",{children:a}):(0,r.jsx)(p.b,{columns:T(V),data:el,filterColumn:"NARRATION",filterPlaceholder:"Filter Narration...",showAllRows:!0})]})]})})}),(0,r.jsx)(b.lG,{open:Q,onOpenChange:J,children:(0,r.jsxs)(b.Cf,{className:"max-h-[80vh] max-w-[70%] overflow-y-auto",children:[(0,r.jsxs)(b.c7,{children:[(0,r.jsx)(b.L3,{children:"Bill Data Amount"}),(0,r.jsx)(b.rr,{children:"Details related to Bill Amount."})]}),I?(0,r.jsx)(f.A,{columns:4,rows:5}):F?(0,r.jsx)("h3",{children:a}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-row justify-center gap-10 items-center",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center gap-3",children:[(0,r.jsx)("span",{className:"font-semibold text-lg text-card-foreground",children:"Total Amount:"}),(0,r.jsx)("span",{className:"text-card-foreground ".concat(ec>=0?"text-green-600":"text-red-600"),children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(ec)})]}),(0,r.jsxs)("div",{className:"flex justify-center items-center gap-6 m-2",children:[(0,r.jsx)("span",{className:"font-semibold text-lg text-card-foreground",children:"Expense Details:"}),(0,r.jsx)("span",{className:"font-semibold ".concat(ei>=0?"text-green-600":"text-red-400"),children:(0,r.jsx)(D.A,{animateOn:"view",revealDirection:"center",characters:"12345678",text:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2,minimumFractionDigits:2}).format(ei)})}),(0,r.jsxs)(S,{children:[ee.length>0&&(0,r.jsx)(M,{asChild:!0,children:(0,r.jsx)(N.$,{variant:"ghost",size:"sm",children:G?(0,r.jsx)(i.A,{size:8}):(0,r.jsx)(c.A,{size:8})})}),ee.length>0&&(0,r.jsx)(_,{align:"center",side:"bottom",className:"w-[320px] p-4 bg-white shadow-lg border border-gray-200 rounded-lg",children:(0,r.jsx)("div",{className:"space-y-2",children:ee.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-between items-center p-2",children:[(0,r.jsx)("span",{className:"text-sm",children:e.label}),(0,r.jsxs)("span",{className:"text-sm",children:[new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(e.amount||0)," "]})]},t))})})]})]})]}),(0,r.jsx)(p.b,{columns:w,data:et,showAllRows:!0})]})]})}),P&&(0,r.jsx)(R.B,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[247,814,794,176,42,518,802,272,139,76,92,473,441,517,358],()=>t(8832)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2219],{34366:(e,r,t)=>{Promise.resolve().then(t.bind(t,99926))},99926:(e,r,t)=>{"use strict";t.d(r,{default:()=>z});var a=t(95155),s=t(12115),l=t(22130),n=t(73312),i=t(37528),d=t(25121),c=t(30814),o=t(47282),u=t(67328),h=t(12711),m=t(85147),x=t(55546),f=t(17733);let p=[{id:"clientId",accessorKey:"clientId",header:"Client ID",cell:e=>{var r;let{row:t}=e,s=null!==(r=t.original.clientId)&&void 0!==r?r:"-";return(0,a.jsx)("div",{className:"font-medium",children:s})}},{id:"boid",accessorKey:"boid",header:"BOID"},{id:"isin",accessorKey:"isin",header:"ISIN",hidden:!0},{id:"branchcode",accessorKey:"branchcode",header:"Branch Code"},{id:"quantity",accessorKey:"quantity",header:"Total Quantity"},{id:"applied",accessorKey:"applied",header:"Applied Quantity"},{id:"orderStatus",accessorKey:"orderStatus",header:"Order Status",cell:e=>{let{row:r}=e,t=r.original.orderStatus;if(!t)return"-";let s=t.toLowerCase(),l="";return l="processed"===s?"bg-green-100 text-green-800 hover:bg-green-200 border border-green-200":"applied"===s?"bg-amber-50 text-amber-700 hover:bg-amber-100 border border-amber-200":"cancelled"===s?"bg-red-100 text-red-800 hover:bg-red-200 border border-red-200":"bg-gray-100 text-gray-800 hover:bg-gray-200 border border-gray-200",(0,a.jsx)(d.E,{className:l,children:t})}},{id:"appliedDate",accessorKey:"appliedDate",header:"Time",cell:e=>{let{row:r}=e,t=r.original.appliedDate;return t?(0,f.GP)(new Date(t),"yyyy-MM-dd HH:mm:ss"):"-"}}];var b=t(45686),g=t(86659),j=t(93650),y=t(65753),w=t(69660),N=t(72508),v=t(69606),C=t(85060),S=t(51344),I=t(44870),k=t(33900),E=t(84179),R=t(43415);let P=R.Ik({exchange:R.k5(["NSE","BSE"],{required_error:"Please select an exchange."}),batchId:R.Yj().min(1,"Please enter a batch ID.")});function A(e){let{isOpen:r,onOpenChange:t,onGenerateFile:l,dataAvailable:i}=e,[d,o]=(0,s.useState)(!1),u=(0,v.mN)({resolver:(0,C.u)(P),defaultValues:{exchange:void 0,batchId:""}});(0,s.useEffect)(()=>{r||u.reset({exchange:void 0,batchId:""})},[r,u]);let h=async e=>{if(!i){c.oR.error("Data not available. Cannot generate file."),t(!1);return}o(!0);try{await l(e)}catch(e){console.error("Error submitting form:",e),c.oR.error("Failed to submit form. Please try again.")}finally{o(!1),t(!1)}};return(0,a.jsx)(S.lG,{open:r,onOpenChange:t,children:(0,a.jsxs)(S.Cf,{children:[(0,a.jsx)(S.c7,{children:(0,a.jsx)(S.L3,{children:"Generate File"})}),(0,a.jsx)(I.lV,{...u,children:(0,a.jsxs)("form",{onSubmit:u.handleSubmit(h),className:"space-y-4",children:[(0,a.jsx)(I.zB,{control:u.control,name:"exchange",render:e=>{let{field:r}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Exchange"}),(0,a.jsx)(I.MJ,{children:(0,a.jsxs)(E.z,{onValueChange:r.onChange,defaultValue:r.value,className:"flex flex-col space-y-1",children:[(0,a.jsxs)(I.eI,{className:"flex items-center space-x-3 space-y-0",children:[(0,a.jsx)(I.MJ,{children:(0,a.jsx)(E.C,{value:"NSE"})}),(0,a.jsx)(I.lR,{className:"font-normal",children:"NSE"})]}),(0,a.jsxs)(I.eI,{className:"flex items-center space-x-3 space-y-0",children:[(0,a.jsx)(I.MJ,{children:(0,a.jsx)(E.C,{value:"BSE"})}),(0,a.jsx)(I.lR,{className:"font-normal",children:"BSE"})]})]})}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsx)(I.zB,{control:u.control,name:"batchId",render:e=>{let{field:r}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Batch ID"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(k.p,{placeholder:"Enter batch ID",...r})}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsxs)(S.Es,{children:[(0,a.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>{u.reset({exchange:void 0,batchId:""}),t(!1)},children:"Cancel"}),(0,a.jsx)(n.$,{type:"submit",className:"bg-teal-600 hover:bg-teal-700 text-white",disabled:d,children:d?"Generating...":(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Generate"]})})]})]})})]})})}var D=t(43932),F=t.n(D),O=t(77711),L=t(74317),B=t(68678);let M=(0,O.default)(()=>Promise.all([t.e(1122),t.e(3930),t.e(343),t.e(9690),t.e(4390),t.e(2449),t.e(8417),t.e(4156),t.e(227),t.e(5996),t.e(3694)]).then(t.bind(t,75996)),{loadableGenerated:{webpack:()=>[75996]},ssr:!1});function z(){let[e,r]=(0,s.useState)([]),[t,f]=(0,s.useState)(!1),[v,C]=(0,s.useState)(null),[S,I]=(0,s.useState)(!1);(0,x.U)("(max-width: 640px)");let[k,E]=(0,s.useState)(!1),[R,P]=(0,s.useState)([]),[D,O]=(0,s.useState)(""),[z,q]=(0,s.useState)(null),[J,G]=(0,s.useState)([]),[K,_]=(0,s.useState)(!1),[T,V]=(0,s.useState)(!1),[H,Q]=(0,s.useState)(""),$=(0,s.useRef)(null),U=(0,s.useRef)([]),W=(0,s.useRef)(null),X=(0,s.useCallback)(()=>{if(!$.current)return[];let e=F()($.current).find("table");if(!e)return[];let r=e.DataTable(),t=r.rows({selected:!0}).nodes();return r.rows({selected:!0}).data().toArray().map((e,r)=>{let a=F()(t[r]),s=a.next("tr.child"),l={};return a.add(s).find("input, select, textarea").each(function(){let e=F()(this).attr("name")||F()(this).attr("data-id");e&&(l[e]=this.value)}),{...e,inputs:l}})},[]),Z=(0,s.useCallback)(async()=>{f(!0),C(null);try{let e=await (0,o.D5k)();if(!(0,u.k9)(e)){I(!0);return}let r="string"==typeof e.data.data?JSON.parse(e.data.data):e.data.data;if(r)P(r.map(e=>({scrip:e.scrip,value:e.buybackid.toString(),isin:e.isin,fromdate:e.fromdate,todate:e.todate,buybackprice:e.buybackprice,nsesettno:e.nsesettno,bsesettno:e.bsesettno})));else throw Error(r["Error Description"]||"Failed to fetch template data.")}catch(e){C(e.message||"An error occurred while fetching data.")}finally{f(!1)}},[]);(0,s.useEffect)(()=>{Z()},[Z]);let Y=(0,s.useCallback)(async e=>{f(!0),C(null);try{let t=await (0,o.Uad)({isin:e});if(!(0,u.k9)(t)){I(!0);return}let a="string"==typeof t.data.data?JSON.parse(t.data.data):t.data.data;r(a&&Array.isArray(a)&&a.length>0?a:[])}catch(e){C(e.message||"An error occurred while fetching data.")}finally{f(!1)}},[]),ee=(0,s.useCallback)(async()=>{let e=J.length>0?J:U.current;if(k||0===e.length){c.oR.error("Please select orders to delete.");return}E(!0);try{if(!(null==z?void 0:z.scrip)||!D){c.oR.error("Please select a company first.");return}let r=e.map(e=>({boid:e.boid,scrip:z.scrip,isin:e.original.isin,orderStatus:e.original.orderStatus,buybackid:Number.parseInt(D),clientId:e.clientId.toString(),quantity:e.quantity.toString(),applied:e.applied.toString(),id:e.original.id})),t=await (0,o.d9e)({data:r});if(!(0,u.k9)(t)){I(!0);return}let a=t.data;a&&a.data?a.data.every(e=>!0===e.status)?(c.oR.success("Orders deleted successfully."),await Y(z.isin)):c.oR.error("Failed to delete order. Please check and try again."):c.oR.error("Some orders failed to delete.")}catch(e){c.oR.error("Error: ".concat(e.message||"Unknown error"))}finally{var r;E(!1),null===(r=W.current)||void 0===r||r.close(),G([]),U.current=[]}},[J,z,D,Y,k,E,I]),er=async e=>{V(!0);try{let r=(null==z?void 0:z.isin)||"",t=await (0,o.jQu)({isin:r,batch:e.batchId,exchange:e.exchange});if(!(0,u.k9)(t)){I(!0);return}if(t.data&&t.data.data&&t.data.data.zipfile){let e=t.data.data.zipfile;(function(e){let r=document.createElement("a");r.href=e,r.download=function(e){let r=e.split("/");return r[r.length-1]}(e),document.body.appendChild(r),r.click(),document.body.removeChild(r)})(e),c.oR.success("File generated successfully!"),await Y(r)}else c.oR.error("Missing zip file link in the response")}catch(e){console.error("Error generating file:",e),c.oR.error("Failed to generate file. Please try again.")}finally{V(!1)}};return(0,s.useEffect)(()=>{if(!$.current||0===e.length)return;let r=F()($.current);return r.off("select.dt"),r.on("select.dt",(e,r,t,a)=>{if("row"===t){if(1===a.length){let e=a[0],t=r.row(e).data(),s=r.row(e).node();if(["PROCESSED"].includes(t.original.orderStatus)){F()(s).data("suppressCheckbox",!0),r.row(e).deselect(),c.oR.warning("Cannot select order for ".concat(t.original.clientId||"this client"," - Please only select orders with the 'APPLIED' status."),{position:"top-center",duration:5e3}),F()(s).find(".rowCheckbox").prop("checked",!1);return}if(["CANCELLED"].includes(t.original.orderStatus)){F()(s).data("suppressCheckbox",!0),r.row(e).deselect(),c.oR.warning("Cannot select order for ".concat(t.original.clientId||"this client"," - The order is already cancelled. Please only select orders with the 'APPLIED' order status."),{position:"top-center",duration:5e3}),F()(s).find(".rowCheckbox").prop("checked",!1);return}}else if(a.length>1){let e=[];if(a.forEach(t=>{let a=r.row(t).data(),s=r.row(t).node();["PROCESSED","CANCELLED"].includes(a.original.orderStatus)?(F()(s).data("suppressCheckbox",!0),r.row(t).deselect(),e.push(a.original.clientId||"this client"),F()(s).find(".rowCheckbox").prop("checked",!1)):["APPLIED"].includes(a.original.orderStatus)&&(F()(s).find(".rowCheckbox").prop("checked",!0),F()(s).data("shouldCheck",!0))}),e.length>0){let r=e.slice(0,3),t=e.length-3;t>0?c.oR.warning("Cannot select orders for clients: ".concat(r.join(", ")," and ").concat(t," more - Please only select orders with the 'APPLIED' status."),{position:"top-center",duration:5e3}):c.oR.warning("Cannot select order".concat(r.length>1?"s":""," for ").concat(r.join(", ")," - Please only select orders with the 'APPLIED' status."),{position:"top-center",duration:5e3})}}}}),()=>{$.current&&r.off("select.dt")}},[e]),(0,a.jsxs)(h.default,{children:[(0,a.jsxs)(l.Zp,{className:"w-full",children:[(0,a.jsx)(l.aR,{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-2 sm:space-y-0",children:(0,a.jsx)(l.ZB,{children:"Manage Orders"})}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsx)("div",{className:"bg-slate-50 rounded-md p-1 mb-2",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-3 items-start md:items-center justify-between",children:[(0,a.jsx)("div",{className:"w-full md:w-auto",children:(0,a.jsx)("div",{className:"relative w-full md:w-[260px]",children:(0,a.jsxs)(i.l6,{value:D,onValueChange:e=>{if(!e||"NONE"===e){c.oR.error("Please select a company."),O(""),r([]),q(null);return}O(e);let t=R.find(r=>r.value===e);t&&(q(t),Y(t.isin))},children:[(0,a.jsx)(i.bq,{className:"w-full bg-white h-9",children:(0,a.jsx)(i.yv,{placeholder:"Select a company"})}),(0,a.jsxs)(i.gC,{children:[(0,a.jsx)(i.eb,{value:"NONE",children:"Select a company"}),R.map(e=>(0,a.jsx)(i.eb,{value:e.value,children:e.scrip},e.value))]})]})})}),z&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 w-full md:w-auto justify-start md:justify-end",children:[(0,a.jsxs)(n.$,{variant:"destructive",size:"sm",onClick:()=>{var e;let r=X();if(0===r.length){c.oR.error("Please select at least one order to delete");return}U.current=r,G(r),null===(e=W.current)||void 0===e||e.open()},disabled:t,className:"whitespace-nowrap",children:[(0,a.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Delete Order"]}),(0,a.jsxs)(n.$,{onClick:()=>_(!0),className:"bg-teal-600 hover:bg-teal-700 text-white whitespace-nowrap",disabled:0===e.length||T||t,size:"sm",children:[(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Generate File"]})]})]})}),(0,a.jsx)(B.A,{selectedCompanyDetails:z}),D&&"NONE"!==D&&(0,a.jsx)(a.Fragment,{children:t?(0,a.jsx)(m.A,{columns:4,rows:10}):v?(0,a.jsx)("div",{className:"text-center text-red-500 p-4 bg-red-100 rounded-md",children:v}):0===e.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-4 text-center bg-muted/20 rounded-md border border-dashed border-muted-foreground/20 my-4",children:[(0,a.jsx)("div",{className:"rounded-full bg-muted p-3 mb-4",children:(0,a.jsx)(j.A,{className:"h-8 w-8 text-muted-foreground"})}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No records found"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4 max-w-md",children:"There are no records available for this criteria."})]}):(0,a.jsx)("div",{className:"overflow-x-auto mt-0",ref:$,children:(0,a.jsx)(M,{columns:p,data:e,selectableRows:!0,showPagination:!0,filterColumn:"clientId"},"buyback_table")})})]})]}),(0,a.jsx)(A,{isOpen:K,onOpenChange:_,onGenerateFile:er,dataAvailable:e.length>0}),(0,a.jsx)(L.A,{ref:W,title:"Confirm Delete",onConfirm:ee,confirmLoading:k,confirmText:"Delete",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-base",children:"Are you sure you want to delete the selected buyback order(s)?"}),z&&(0,a.jsx)("div",{className:"flex flex-col space-y-1 p-2 bg-slate-50 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(y.A,{className:"h-5 w-5 text-blue-500"}),(0,a.jsx)("span",{className:"font-semibold",children:z.scrip}),z.isin&&(0,a.jsxs)("div",{className:"flex items-center gap-1 ml-auto",children:[(0,a.jsx)(w.A,{className:"h-4 w-4 text-slate-500"}),(0,a.jsx)(d.E,{variant:"secondary",className:"font-medium",children:z.isin})]})]})})]}),(0,a.jsx)("div",{className:"rounded-md border overflow-hidden max-h-[200px] overflow-y-auto",children:(0,a.jsxs)(N.XI,{children:[(0,a.jsx)(N.A0,{children:(0,a.jsxs)(N.Hj,{children:[(0,a.jsx)(N.nd,{className:"w-1/2",children:"Client ID"}),(0,a.jsx)(N.nd,{className:"w-1/2",children:"Applied Quantity"})]})}),(0,a.jsx)(N.BF,{children:J&&J.length>0?J.map((e,r)=>{var t;return(0,a.jsxs)(N.Hj,{children:[(0,a.jsx)(N.nA,{className:"font-medium py-2",children:e.clientId}),(0,a.jsx)(N.nA,{className:"py-2",children:(null===(t=e.original)||void 0===t?void 0:t.applied)||"-"})]},r)}):(0,a.jsx)(N.Hj,{children:(0,a.jsx)(N.nA,{colSpan:2,className:"text-center py-3 text-muted-foreground",children:"No orders selected"})})})]})}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:(0,a.jsx)("p",{children:"This action cannot be undone. Please review the details before confirming."})})]})}),S&&(0,a.jsx)(u.Bs,{})]})}},44870:(e,r,t)=>{"use strict";t.d(r,{C5:()=>g,MJ:()=>p,Rr:()=>b,eI:()=>x,lR:()=>f,lV:()=>c,zB:()=>u});var a=t(95155),s=t(12115),l=t(14707),n=t(69606),i=t(21567),d=t(98986);let c=n.Op,o=s.createContext({}),u=e=>{let{...r}=e;return(0,a.jsx)(o.Provider,{value:{name:r.name},children:(0,a.jsx)(n.xI,{...r})})},h=()=>{let e=s.useContext(o),r=s.useContext(m),{getFieldState:t,formState:a}=(0,n.xW)(),l=t(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=r;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...l}},m=s.createContext({}),x=s.forwardRef((e,r)=>{let{className:t,...l}=e,n=s.useId();return(0,a.jsx)(m.Provider,{value:{id:n},children:(0,a.jsx)("div",{ref:r,className:(0,i.cn)("space-y-2",t),...l})})});x.displayName="FormItem";let f=s.forwardRef((e,r)=>{let{className:t,...s}=e,{error:l,formItemId:n}=h();return(0,a.jsx)(d.J,{ref:r,className:(0,i.cn)(l&&"text-destructive",t),htmlFor:n,...s})});f.displayName="FormLabel";let p=s.forwardRef((e,r)=>{let{...t}=e,{error:s,formItemId:n,formDescriptionId:i,formMessageId:d}=h();return(0,a.jsx)(l.DX,{ref:r,id:n,"aria-describedby":s?"".concat(i," ").concat(d):"".concat(i),"aria-invalid":!!s,...t})});p.displayName="FormControl";let b=s.forwardRef((e,r)=>{let{className:t,...s}=e,{formDescriptionId:l}=h();return(0,a.jsx)("p",{ref:r,id:l,className:(0,i.cn)("text-[0.8rem] text-muted-foreground",t),...s})});b.displayName="FormDescription";let g=s.forwardRef((e,r)=>{let{className:t,children:s,...l}=e,{error:n,formMessageId:d}=h(),c=n?String(null==n?void 0:n.message):s;return c?(0,a.jsx)("p",{ref:r,id:d,className:(0,i.cn)("text-[0.8rem] font-medium text-destructive",t),...l,children:c}):null});g.displayName="FormMessage"},98986:(e,r,t)=>{"use strict";t.d(r,{J:()=>c});var a=t(95155),s=t(12115),l=t(46195),n=t(31027),i=t(21567);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(l.b,{ref:r,className:(0,i.cn)(d(),t),...s})});c.displayName=l.b.displayName},84179:(e,r,t)=>{"use strict";t.d(r,{C:()=>c,z:()=>d});var a=t(95155),s=t(12115),l=t(852),n=t(33565),i=t(21567);let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(l.bL,{className:(0,i.cn)("grid gap-2",t),...s,ref:r})});d.displayName=l.bL.displayName;let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)(l.q7,{ref:r,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,a.jsx)(l.C1,{className:"flex items-center justify-center",children:(0,a.jsx)(n.A,{className:"h-3.5 w-3.5 fill-primary"})})})});c.displayName=l.q7.displayName}},e=>{var r=r=>e(e.s=r);e.O(0,[3740,1181,8526,8562,164,2589,814,8007,5565,9526,6143,4015,8665,6527,7518,7733,6963,6137,7555,7328,9086,1816,8441,1517,7358],()=>r(34366)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4808],{57686:(e,t,a)=>{Promise.resolve().then(a.bind(a,71746))},71746:(e,t,a)=>{"use strict";a.d(t,{default:()=>S});var r=a(95155),n=a(12115),s=a(22130);let l=[{id:"SCRIP_SYMBOL",accessorKey:"SCRIP_SYMBOL",header:"Scrip Symbol",cell:e=>{let{row:t}=e;return(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)("span",{children:t.original.SCRIP_SYMBOL})})}},{id:"COMPANY_CODE",accessorKey:"COMPANY_CODE",header:"Company Code",deselected:!0},{id:"COMPCODE",accessorKey:"COMPCODE",header:"COMPCODE",deselected:!0},{id:"TRADING_QUANTITY",accessorKey:"TRADING_QUANTITY",header:"Opening Quantity"},{id:"TRADING_AMOUNT",accessorKey:"TRADING_AMOUNT",header:"Opening Amount",amountToBe:!0,dtRender:function(e,t,a){let r=parseFloat(e),n=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(r);return"display"===t?'<span data-sort="'.concat(r,'">').concat(n,"</span>"):r}},{id:"BUY_QUANTITY",accessorKey:"BUY_QUANTITY",header:"Buy Quantity"},{id:"BUY_RATE",accessorKey:"BUY_RATE",header:"Buy Rate"},{id:"BUY_AMOUNT",accessorKey:"BUY_AMOUNT",header:"Buy Amount",amountToBe:!0,dtRender:function(e,t,a){let r=parseFloat(e),n=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(r);return"display"===t?'<span data-sort="'.concat(r,'">').concat(n,"</span>"):r}},{id:"SALE_QUANTITY",accessorKey:"SALE_QUANTITY",header:"Sell Quantity"},{id:"SALE_RATE",accessorKey:"SALE_RATE",header:"Sell Rate"},{id:"SALE_AMOUNT",accessorKey:"SALE_AMOUNT",header:"Sell Amount",amountToBe:!0,dtRender:function(e,t,a){let r=parseFloat(e),n=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(r);return"display"===t?'<span data-sort="'.concat(r,'">').concat(n,"</span>"):r}},{id:"NET_QUANTITY",accessorKey:"NET_QUANTITY",header:"Net Quantity"},{id:"NET_RATE",accessorKey:"NET_RATE",header:"Net Rate"},{id:"NET_AMOUNT",accessorKey:"NET_AMOUNT",header:"Net Amount",amountToBe:!0,dtRender:function(e,t,a){let r=parseFloat(e),n=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(r);return"display"===t?'<span data-sort="'.concat(r,'" class="').concat(r>=0?"text-green-600":"text-red-600",'">').concat(n,"</span>"):r}},{id:"CLOSING_PRICE",accessorKey:"CLOSING_PRICE",header:"Closing Price",amountToBe:!0},{id:"NOT_PROFIT",accessorKey:"NOT_PROFIT",header:"Net Profit",amountToBe:!0,dtRender:function(e,t,a){let r=parseFloat(e),n=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(r);return"display"===t?'<span data-sort="'.concat(r,'" class="').concat(r>=0?"text-green-600":"text-red-600",'">').concat(n,"</span>"):r}}];var o=a(47282),c=a(67328),d=a(12711),i=a(85147),u=a(1541),m=a(44870),N=a(69606),x=a(43415),h=a(85060),p=a(17733),y=a(37528),f=a(33900),T=a(73312),O=a(77594),I=a(20853),A=a(42020),j=a(87081);let w=e=>{let{data:t,loading:a}=e;return a?[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("div",{className:"flex border flex-wrap gap-2 items-center justify-between p-2 rounded-md shadow-sm",children:[(0,r.jsx)(j.E,{className:"h-5 w-24"}),(0,r.jsx)(j.E,{className:"h-4 w-12"}),(0,r.jsx)(j.E,{className:"h-4 w-20"})]},t)):0===t.length?null:t.map(e=>{let{code:t,sum:a}=e;return(0,r.jsxs)("div",{className:"flex border flex-wrap gap-2 items-center justify-between cursor-pointer hover:bg-accent hover:text-accent-foreground p-2 rounded-md transition-all duration-300 ease-in-out group shadow-sm hover:shadow-md",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold group-hover:underline transition-all duration-200",children:"CAPITAL"===t?"EQUITY":t}),(0,r.jsx)("p",{className:"text-xs font-regular",children:a>=0?"Profit":"Loss"}),(0,r.jsx)("p",{className:"text-xs ".concat(a>=0?"text-green-600":"text-red-600"," transition-colors duration-300 flex gap-2"),children:(0,r.jsx)(u.A,{animateOn:"view",revealDirection:"center",characters:"123456789",text:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(a)})})]},t)})},C=(0,a(77711).default)(()=>Promise.all([a.e(1122),a.e(3740),a.e(3930),a.e(343),a.e(9690),a.e(4390),a.e(2449),a.e(8417),a.e(4156),a.e(227),a.e(5996),a.e(3302)]).then(a.bind(a,75996)),{loadableGenerated:{webpack:()=>[75996]},ssr:!1,loading:()=>(0,r.jsx)(i.A,{columns:4,rows:10})});function S(){let[e,t]=(0,n.useState)([]),[a,j]=(0,n.useState)(0),[S,E]=(0,n.useState)(0),[_,g]=(0,n.useState)(0),[P,b]=(0,n.useState)(0),[v,M]=(0,n.useState)(0),[R,D]=(0,n.useState)(!0),[Y,F]=(0,n.useState)([]),[B,U]=(0,n.useState)(!1),[L,K]=(0,n.useState)(null),G=(()=>{let e=new Date,t=e.getMonth(),a=e.getFullYear(),r=t<3?a-1:a;return Array.from({length:5},(e,t)=>{let a=r-t;return{label:"".concat(a,"-").concat(a+1),value:"".concat(a,"-").concat(a+1),fromDate:(0,p.GP)(new Date(a,3,1),"dd/MM/yyyy"),toDate:(0,p.GP)(new Date(a+1,2,31),"dd/MM/yyyy")}})})(),Q=x.Ik({financialYear:x.Ik({fromDate:x.Yj(),toDate:x.Yj(),value:x.Yj()}),toDate:x.Yj().nonempty("To Date is required")}),k=(0,N.mN)({resolver:(0,h.u)(Q),defaultValues:{financialYear:G[0],toDate:G[0].toDate}}),{watch:V,setValue:q}=k;(0,n.useEffect)(()=>{let e=V((e,t)=>{let{name:a}=t;if("financialYear"===a){var r;q("toDate",(null===(r=e.financialYear)||void 0===r?void 0:r.toDate)||G[0].toDate)}});return()=>e.unsubscribe()},[V,G,q]);let z=async(e,a)=>{D(!0),K(null);try{let e=await (0,o.eq0)({toDate:a});if(!(0,c.k9)(e)){U(!0);return}let r="string"==typeof e.data.data?JSON.parse(e.data.data):e.data.data;if("True"===r.Success&&r["Success Description"]){let e=r["Success Description"],a=e.filter(e=>"DERIVATIVES"===e.COMPANY_CODE||"CAPITAL"===e.COMPANY_CODE||"MFSS"===e.COMPANY_CODE||"COMMODITY"===e.COMPANY_CODE),n=a.filter(e=>"CAPITAL"===e.COMPANY_CODE).reduce((e,t)=>e+Number.parseFloat(t.NOT_PROFIT||0),0),s=a.filter(e=>"DERIVATIVES"===e.COMPANY_CODE).reduce((e,t)=>e+Number.parseFloat(t.NOT_PROFIT||0),0),l=a.filter(e=>"MFSS"===e.COMPANY_CODE).reduce((e,t)=>e+Number.parseFloat(t.NOT_PROFIT||0),0),o=a.filter(e=>"COMMODITY"===e.COMPANY_CODE).reduce((e,t)=>e+Number.parseFloat(t.NOT_PROFIT||0),0);t(a),j(n),E(s),g(l),b(o);let c=e.filter(e=>"EXPENSES"===e.COMPANY_CODE),d=c.reduce((e,t)=>e+Number.parseFloat(t.NOT_PROFIT||0),0);F(c),M(d)}else throw Error("Failed to fetch data.")}catch(e){K(e.message||"An error occurred while fetching data.")}finally{D(!1)}};(0,n.useEffect)(()=>{let{fromDate:e,toDate:t}=G[0];z(e,t)},[]);let J=null==Y?void 0:Y.reduce((e,t)=>{var a;return e+parseFloat((null===(a=t.NOT_PROFIT)||void 0===a?void 0:a.toString())||"0")},0),$=e=>e.replace(/^\*|\*$/g,""),X=(()=>{let e={};Y.forEach(t=>{let{SCRIP_SYMBOL:a,NOT_PROFIT:r}=t,n=$(a),s="CGST"===n||"SGST"===n?"GST":n;e[s]||(e[s]={SCRIP_SYMBOL:s,NOT_PROFIT:0}),e[s].NOT_PROFIT+=Math.abs(Number(r))});let t=Object.values(e),a=["STT","STAMP DUTY","GST"];return t.sort((e,t)=>{let r=a.indexOf(e.SCRIP_SYMBOL),n=a.indexOf(t.SCRIP_SYMBOL);return -1!==r&&-1!==n?r-n:-1!==r?-1:-1!==n?1:0})})(),Z=a+S+_+P-Math.abs(Number(J)),W=e=>{setTimeout(()=>{let t=document.getElementById(e);if(!t){console.error("Element with id '".concat(e,"' not found."));return}try{t.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}catch(a){console.warn("scrollIntoView failed, using fallback scrolling",a);let e=t.getBoundingClientRect();window.scrollTo({top:window.scrollY+e.top-50,behavior:"smooth"})}},100)},H=(0,n.useMemo)(()=>[...new Set(e.map(e=>e.COMPANY_CODE))].map(t=>{let a=e.filter(e=>e.COMPANY_CODE===t).reduce((e,t)=>e+Number.parseFloat(t.NOT_PROFIT||"0"),0);return{filteredCode:"CAPITAL"===t?"EQUITY":t,sum:a}}).filter(e=>0!==e.sum),[e]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.default,{children:(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)(s.Zp,{children:[(0,r.jsxs)(s.aR,{className:"flex flex-col md:flex-col sm:flex-col  mb-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(s.ZB,{children:"Annual P&L"})}),(0,r.jsx)("div",{className:"flex-shrink-0 m-0",children:(0,r.jsx)(m.lV,{...k,children:(0,r.jsxs)("form",{onSubmit:k.handleSubmit(e=>{let{financialYear:t,toDate:a}=e;z(t.fromDate,a)}),className:"flex gap-3",children:[(0,r.jsx)(m.zB,{control:k.control,name:"financialYear",render:e=>{var t;let{field:a}=e;return(0,r.jsxs)(m.eI,{className:"w-[200px]",children:[(0,r.jsxs)(y.l6,{name:"financialYear",onValueChange:e=>{let t=G.find(t=>t.value===e);a.onChange(t)},defaultValue:(null===(t=a.value)||void 0===t?void 0:t.value)||"",children:[(0,r.jsx)(m.MJ,{children:(0,r.jsx)(y.bq,{children:(0,r.jsx)(y.yv,{placeholder:"Select year"})})}),(0,r.jsx)(y.gC,{children:G.map(e=>(0,r.jsx)(y.eb,{value:e.value,children:e.label},e.value))})]}),(0,r.jsx)(m.C5,{})]})}}),(0,r.jsx)(m.zB,{control:k.control,name:"toDate",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.eI,{className:"w-[150px]",children:[(0,r.jsx)(m.MJ,{children:(0,r.jsx)(f.p,{name:"date",type:"date",className:"flex h-10 w-full rounded-md border text-white bg-transparent px-3 py-2 text-sm ",value:(0,p.GP)(new Date(t.value.split("/").reverse().join("-")),"yyyy-MM-dd"),min:(0,p.GP)(new Date(k.watch("financialYear").fromDate.split("/").reverse().join("-")),"yyyy-MM-dd"),max:(0,p.GP)(new Date(k.watch("financialYear").toDate.split("/").reverse().join("-")),"yyyy-MM-dd"),onChange:e=>{let a=new Date(e.target.value);t.onChange((0,p.GP)(a,"dd/MM/yyyy"))}})}),(0,r.jsx)(m.C5,{})]})}}),(0,r.jsx)(T.$,{name:"submit",type:"submit",disabled:R,children:R?(0,r.jsx)(O.A,{}):(0,r.jsx)(I.A,{className:"h-5 w-5"})})]})})})]}),(0,r.jsx)(s.Wu,{children:R?(0,r.jsx)(i.A,{columns:4,rows:10}):L?(0,r.jsx)("div",{className:"text-center text-red-500 p-4 bg-red-100 rounded-md",children:L}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-wrap justify-start items-center lg:gap-6 sm:gap-3",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold flex gap-2 items-center py-2",children:[(0,r.jsx)("p",{className:"text-sm font-regular",children:Z>=0?"Profit":"Loss"}),(0,r.jsx)("p",{className:"text-sm font-regular ".concat(Z>=0?"text-green-600":"text-red-600"),children:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Z).replace(/^(\D?)(.+)$/,(e,t,a)=>"(".concat(t).concat(a,")"))})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(w,{data:H.map(e=>{let{filteredCode:t,sum:a}=e;return{code:t,sum:a}}),loading:R}),(0,r.jsxs)("div",{onClick:()=>W("expenses"),className:"flex border gap-2 items-center justify-between cursor-pointer hover:bg-accent hover:text-accent-foreground p-2 rounded-md transition-all duration-300 ease-in-out group shadow-sm hover:shadow-md",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold group-hover:underline transition-all duration-200",children:"EXPENSES"}),(0,r.jsx)("p",{className:"text-xs ".concat(v>=0?"text-green-600":"text-red-600"," transition-colors duration-300 flex gap-2"),children:(0,r.jsx)(u.A,{animateOn:"view",revealDirection:"center",characters:"123456789",text:new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(Math.abs(Number(v)))})})]})]})]}),(0,r.jsx)(C,{columns:l,data:e,includeFileData:!0,showAllRows:!0,showPagination:!1,moreDetails:{Realized:{rowKey:"category",rowAmount:"amount",rows:[...H.map(e=>({category:e.filteredCode,amount:e.sum})),{category:"Expenses",amount:v}],total:Z},Expenses:{rowKey:"SCRIP_SYMBOL",rowAmount:"NOT_PROFIT",rows:X,total:Math.abs(v)}}}),(0,r.jsx)("div",{id:"expenses",children:(0,r.jsx)(A.A,{processedExpensesData:X,totalExpenses:v,expenseRowKey:"SCRIP_SYMBOL",expenseRowAmount:"NOT_PROFIT"})})]})})]})})}),B&&(0,r.jsx)(c.Bs,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1181,8526,8562,164,2589,814,8007,5565,9526,6143,4015,8665,6527,7518,5427,7733,6137,7555,7328,9086,5960,8441,1517,7358],()=>t(57686)),_N_E=e.O()}]);
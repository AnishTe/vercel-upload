(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3479],{18629:(e,a,t)=>{Promise.resolve().then(t.bind(t,59749))},59749:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>P});var s=t(95155),r=t(12115),l=t(22130),n=t(76046),i=t(24672),o=t(62153),d=t(43415),c=t(85060),u=t(69606),m=t(65753),f=t(61594),b=t(70865),h=t(9110),x=t(33473),p=t(45686),g=t(98867),v=t(16233),N=t(39877),y=t(81024),j=t(38684),k=t(40767),w=t(46967),C=t(73312),I=t(44870),S=t(33900),A=t(15157),D=t(65564),_=t(51344),q=t(25121),T=t(62884),B=t(84179),R=t(5565),E=t(47282),z=t(27685),J=t(25427);let V=d.Ik({bankName:d.Yj().optional(),bankAddress:d.Yj().optional(),accountNumber:d.Yj().optional(),accountType:d.Yj().optional(),micrNumber:d.Yj().optional(),ifscCode:d.Yj().optional(),chequeImage:d.bz().optional(),isDefault:d.zM().default(!1)}).refine(e=>{var a,t,s,r,l,n;let i=!!(null===(a=e.bankName)||void 0===a?void 0:a.trim())&&!!(null===(t=e.bankAddress)||void 0===t?void 0:t.trim())&&!!(null===(s=e.accountNumber)||void 0===s?void 0:s.trim())&&!!(null===(r=e.accountType)||void 0===r?void 0:r.trim())&&!!(null===(l=e.micrNumber)||void 0===l?void 0:l.trim())&&!!(null===(n=e.ifscCode)||void 0===n?void 0:n.trim()),o=!!e.chequeImage;return i||o},{message:"Either all bank details or a cancelled cheque must be provided.",path:["chequeImage"]}).superRefine((e,a)=>{if(!e.chequeImage){var t,s,r,l,n,i;(null===(t=e.bankName)||void 0===t?void 0:t.trim())||a.addIssue({path:["bankName"],code:d.eq.custom,message:"Bank Name is required"}),(null===(s=e.bankAddress)||void 0===s?void 0:s.trim())||a.addIssue({path:["bankAddress"],code:d.eq.custom,message:"Bank Address is required"}),(null===(r=e.accountNumber)||void 0===r?void 0:r.trim())||a.addIssue({path:["accountNumber"],code:d.eq.custom,message:"Account Number is required"}),(null===(l=e.accountType)||void 0===l?void 0:l.trim())||a.addIssue({path:["accountType"],code:d.eq.custom,message:"Account Type is required"}),(null===(n=e.micrNumber)||void 0===n?void 0:n.trim())||a.addIssue({path:["micrNumber"],code:d.eq.custom,message:"MICR is required"}),(null===(i=e.ifscCode)||void 0===i?void 0:i.trim())||a.addIssue({path:["ifscCode"],code:d.eq.custom,message:"IFSC code is required"})}});function O(e){let{onFormSubmitted:a}=e,[t,n]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),[O,P]=(0,r.useState)([]),[M,F]=(0,r.useState)("bank-0"),[Y,U]=(0,r.useState)([null]),[L,$]=(0,r.useState)([null]),{toast:G}=(0,D.dj)(),[W,Z]=(0,r.useState)(!1),X=(0,r.useRef)(!1),H=(0,r.useRef)(!1),{handleStepCompletion:Q,checkTokenValidity:K}=(0,i.b)(),ee=(0,r.useMemo)(()=>({bankName:"",bankAddress:"",accountNumber:"",accountType:"",micrNumber:"",ifscCode:"",chequeImage:void 0,isDefault:!1}),[]),ea=(0,u.mN)({resolver:(0,c.u)(V),defaultValues:ee,mode:"onChange"}),et=e=>{var a,t,s,r,l,n;let i=(null===(a=e.bankName)||void 0===a?void 0:a.trim())&&(null===(t=e.bankAddress)||void 0===t?void 0:t.trim())&&(null===(s=e.accountNumber)||void 0===s?void 0:s.trim())&&(null===(r=e.accountType)||void 0===r?void 0:r.trim())&&(null===(l=e.micrNumber)||void 0===l?void 0:l.trim())&&(null===(n=e.ifscCode)||void 0===n?void 0:n.trim()),o=!!e.chequeImage;return!!(i||o)},es=e=>{var a,t,s,r,l,n;return!!((null===(a=e.bankName)||void 0===a?void 0:a.trim())||(null===(t=e.bankAddress)||void 0===t?void 0:t.trim())||(null===(s=e.accountNumber)||void 0===s?void 0:s.trim())||(null===(r=e.accountType)||void 0===r?void 0:r.trim())||(null===(l=e.micrNumber)||void 0===l?void 0:l.trim())||(null===(n=e.ifscCode)||void 0===n?void 0:n.trim())||e.chequeImage)},er=(0,r.useCallback)(()=>{let e=Number.parseInt(M.split("-")[1]);if(e>=0&&e<O.length){let a=ea.getValues();P(t=>{var s;let r=[...t];r[e]={...a,isDefault:(null===(s=t[e])||void 0===s?void 0:s.isDefault)||!1};try{localStorage.setItem("kyc_banks",JSON.stringify(r))}catch(e){console.error("Error saving to localStorage:",e)}return r})}},[M,O.length,ea]),el=(0,r.useCallback)(e=>{if(X.current)return;X.current=!0;let a=Number.parseInt(M.split("-")[1]),t=Number.parseInt(e.split("-")[1]);if(a===t){X.current=!1;return}let s=ea.getValues();P(r=>{let l=[...r];if(a>=0&&a<l.length){var n;l[a]={...s,isDefault:(null===(n=l[a])||void 0===n?void 0:n.isDefault)||!1}}try{localStorage.setItem("kyc_banks",JSON.stringify(l))}catch(e){console.error("Error saving to localStorage:",e)}return setTimeout(()=>{if(l[t]){let e={bankName:l[t].bankName||"",bankAddress:l[t].bankAddress||"",accountNumber:l[t].accountNumber||"",accountType:l[t].accountType||"",micrNumber:l[t].micrNumber||"",ifscCode:l[t].ifscCode||"",chequeImage:l[t].chequeImage,isDefault:l[t].isDefault||!1};ea.reset(e)}else ea.reset(ee);F(e),X.current=!1},100),l})},[M,ea,ee]);(0,r.useEffect)(()=>{if(W&&!X.current){let e=ea.watch((e,a)=>{let{name:t}=a;if(t&&!X.current){let e=setTimeout(()=>{X.current||er()},1e3);return()=>clearTimeout(e)}});return()=>{e&&"function"==typeof e.unsubscribe&&e.unsubscribe()}}},[ea,W,er]);let en=(0,r.useCallback)(()=>{if(O.length>=3){G({title:"Maximum banks reached",description:"You can add up to 3 banks only.",variant:"destructive"});return}let e=Number.parseInt(M.split("-")[1]),a=ea.getValues(),t=[...O];if(e>=0&&e<t.length){var s;t[e]={...a,isDefault:(null===(s=t[e])||void 0===s?void 0:s.isDefault)||!1}}let r={...ee,isDefault:!1},l=[...t,r];P(l),$(e=>[...e,null]),U(e=>[...e,null]);try{localStorage.setItem("kyc_banks",JSON.stringify(l))}catch(e){console.error("Error saving to localStorage:",e)}let n=l.length-1;F("bank-".concat(n)),setTimeout(()=>{ea.reset(r)},100),G({title:"Bank added",description:"You can now enter details for the new bank."})},[O,M,ea,ee,G]),ei=e=>{if(O[e].isDefault){G({title:"Cannot remove default bank",description:"Please set another bank as default before removing this one.",variant:"destructive"});return}let a=[...O];a.splice(e,1),P(a);let t=[...L];t.splice(e,1),$(t);let s=[...Y];s.splice(e,1),U(s),(M==="bank-".concat(e)||a.length<=e)&&(F("bank-0"),a.length>0&&ea.reset(a[0])),localStorage.setItem("kyc_banks",JSON.stringify(a)),localStorage.setItem("kyc_bank_cheques",JSON.stringify(t)),G({title:"Bank removed",description:"The bank has been removed successfully."})},eo=(0,r.useCallback)(e=>{let a=Number.parseInt(M.split("-")[1]),t=ea.getValues();P(s=>{let r=[...s];a>=0&&a<r.length&&(r[a]={...t,isDefault:a===e}),r.forEach((a,t)=>{a.isDefault=t===e});try{localStorage.setItem("kyc_banks",JSON.stringify(r))}catch(e){console.error("Error saving to localStorage:",e)}return a===e&&ea.setValue("isDefault",!0),r}),G({title:"Default bank updated",description:"This bank will be used as the default for transactions."})},[M,ea,G]),ed=(0,r.useCallback)(async()=>{try{var e,a,t;n(!0);let s=sessionStorage.getItem("TradingId"),r=sessionStorage.getItem("client_id");if(!s||!r)throw Error("Missing Trading ID or Client ID");let l=await (0,E.S9c)({clientId:r,kycTradingId:s});if(!K(null==l?void 0:null===(e=l.data)||void 0===e?void 0:e.tokenValidity))return;let i=null==l?void 0:null===(t=l.data)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.data,o=[];if(Array.isArray(i)&&i.length>0)(o=i.slice(0,3).map((e,a)=>({bankName:e.beneficiary_name_with_bank||"",bankAddress:e.bank_address||"",accountNumber:e.account_no||"",micrNumber:e.micr_code||"",ifscCode:e.ifsc_code||"",accountType:e.account_type||"",chequeImage:void 0,isDefault:1===e.default_account}))).some(e=>e.isDefault)||(o[0].isDefault=!0),G({title:"Success",description:"Bank details have been prefilled."});else throw Error("No bank data found from API.");P(o),U(Array(o.length).fill(null)),$(Array(o.length).fill(null)),localStorage.setItem("kyc_banks",JSON.stringify(o)),localStorage.setItem("kyc_bank_cheques",JSON.stringify(Array(o.length).fill(null))),ea.reset(o[0]),F("bank-0")}catch(a){console.error("Bank fetch failed:",a);let e={bankName:"",bankAddress:"",accountNumber:"",micrNumber:"",ifscCode:"",accountType:"",chequeImage:void 0,isDefault:!0};P([e]),U([null]),$([null]),localStorage.setItem("kyc_banks",JSON.stringify([e])),localStorage.setItem("kyc_bank_cheques",JSON.stringify([null])),ea.reset(e),F("bank-0"),G({title:"Fallback to manual entry",description:"Couldn't fetch banks from Digio. You can enter them manually.",variant:"destructive"})}finally{n(!1)}},[K,ea,G]);async function ec(e){var a;let t=Number.parseInt(M.split("-")[1]),s=[...O];s[t]={...e,isDefault:(null===(a=s[t])||void 0===a?void 0:a.isDefault)||!1};for(let e=0;e<s.length;e++){let a=s[e];if(es(a)&&!et(a)){F("bank-".concat(e)),setTimeout(()=>{ea.reset(a)},100),G({title:"Bank ".concat(e+1," is incomplete"),description:"Please complete all required fields or upload a cancelled cheque.",variant:"destructive"});return}}let r=s.filter(es);if(0===r.length){G({title:"No bank details provided",description:"Please add at least one bank account.",variant:"destructive"});return}r.some(e=>e.isDefault)||(r[0].isDefault=!0),P(s),d(!0)}async function eu(){let e=sessionStorage.getItem("dematId"),t=sessionStorage.getItem("TradingId")||"",s=sessionStorage.getItem("client_id")||"",r=sessionStorage.getItem("boId"),l=r&&"null"!==r?r:"";if(!e){console.error("Demat ID not found in session storage");return}n(!0),d(!1);try{var i,o,c;let r=O.filter(e=>es(e)&&et(e));if(0===r.length)throw Error("No valid banks found.");let n=r.find(e=>e.isDefault);if(!n||!n.accountNumber||!n.ifscCode)throw Error("Default bank details are incomplete.");let d={dematId:e.toString(),clientId:s,beneficiaryAccountName:"",bankName:n.bankName,bankAddress:n.bankAddress,accountNo:n.accountNumber,accountType:n.accountType,micrCode:n.micrNumber||"",ifscCode:n.ifscCode,defaultAccount:n.isDefault?"YES":"NO",accountStatus:"ACTIVE",bankCcy:"999001",boId:l},u=r.slice(0,3).map(e=>(0,E.Xt7)({clientId:s,boId:l,kycTradingId:t,beneficiary_account_no:e.accountNumber,beneficiary_ifsc:e.ifscCode,beneficiary_bank_name:e.bankName,beneficiary_bank_address:e.bankAddress,beneficiary_account_type:e.accountType,beneficiary_micr:e.micrNumber,default_account:!!e.isDefault})),[m,...f]=await Promise.all([r.length>0?(0,E.Q6i)(d):Promise.resolve({data:[]}),...u]);if(![null==m?void 0:null===(i=m.data)||void 0===i?void 0:i.tokenValidity,...f.map(e=>{var a;return null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.tokenValidity})].every(K))return;let b=(null==m?void 0:null===(c=m.data)||void 0===c?void 0:null===(o=c.data)||void 0===o?void 0:o.status)===!0,h=f.map(e=>{var a,t;return null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.status}).every(e=>!0===e);if(console.log("Bank Success:",b),console.log("Penny Drop Success:",h),!b||!h){G({title:"Bank verification failed",description:b?"Bank verification via penny drop failed.":"Failed to save some bank details. Please try again.",variant:"destructive"});return}setTimeout(()=>{localStorage.setItem("kyc_bank_cheques",JSON.stringify(L)),Q("bank",r,"exchange")},100),G({title:"Bank details saved",description:"Your bank information has been verified."}),a&&a()}catch(e){console.error("Error submitting bank form:",e),G({title:"Error saving bank details",description:"There was an error verifying your bank information. Please try again.",variant:"destructive"}),H.current=!1}finally{n(!1)}}let em=e=>{var a;let t=null===(a=e.target.files)||void 0===a?void 0:a[0];if(!t)return;if(!["image/jpeg","image/png","application/pdf"].includes(t.type)){G({title:"Invalid file type",description:"Please upload a JPG, PNG, or PDF file",variant:"destructive"});return}if(t.size>5242880){G({title:"File too large",description:"Please upload a file smaller than 5MB",variant:"destructive"});return}let s=Number.parseInt(M.split("-")[1]),r=[...Y];if(r[s]=t,U(r),ea.setValue("chequeImage",t,{shouldValidate:!0}),t.type.startsWith("image/")){let e=new FileReader;e.onload=()=>{let a=[...L];a[s]=e.result,$(a),localStorage.setItem("kyc_bank_cheques",JSON.stringify(a))},e.readAsDataURL(t)}else{let e=[...L];e[s]="pdf",$(e),localStorage.setItem("kyc_bank_cheques",JSON.stringify(e))}G({title:"Cheque uploaded",description:"Your cancelled cheque has been uploaded successfully."})},ef=()=>{let e=Number.parseInt(M.split("-")[1]),a=[...Y];a[e]=null,U(a);let t=[...L];t[e]=null,$(t),ea.setValue("chequeImage",void 0,{shouldValidate:!0}),localStorage.setItem("kyc_bank_cheques",JSON.stringify(t))},eb=(0,r.useCallback)(()=>Number.parseInt(M.split("-")[1]),[M]),eh=e=>({savings:"Saving",current:"Current",CashCredit_Overdraft:"Cash Credit / Overdraft"})[e]||e;return((0,r.useEffect)(()=>{W||(ed(),Z(!0))},[W,ed]),W)?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 border-b pb-4 mb-6",children:[(0,s.jsx)("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 p-3 rounded-full shadow-md",children:(0,s.jsx)(m.A,{className:"h-6 w-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Bank Details"}),(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:"You can add up to 3 bank accounts. One account must be set as default."})]})]}),(0,s.jsx)("div",{className:"w-full rounded-md border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800 shadow-sm dark:border-amber-800/30 dark:bg-amber-900/30 dark:text-amber-200",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(f.A,{className:"h-4 w-4 flex-shrink-0"}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"font-semibold",children:"Important:"})," For each bank, you must either complete all bank details fields OR upload a cancelled cheque."]})]})}),(0,s.jsxs)(T.tU,{value:M,onValueChange:el,className:"w-full h-full",children:[(0,s.jsx)("div",{className:"sticky top-0 z-10 border-b pb-4 pt-4 px-2 shadow-lg backdrop-blur-md bg-white/60 dark:bg-black/40 rounded-xl mb-6",children:(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,s.jsx)(T.j7,{className:"grid gap-3 p-1 rounded-xl bg-gray-100 dark:bg-zinc-800 shadow-inner transition-all",style:{gridTemplateColumns:"repeat(".concat(O.length,", minmax(100px, 1fr))")},children:O.map((e,a)=>(0,s.jsxs)(T.Xi,{value:"bank-".concat(a),className:"relative px-4 py-2 rounded-lg text-sm font-medium text-gray-700 dark:text-zinc-200 \n              hover:bg-white hover:shadow-md dark:hover:bg-zinc-700 transition-all duration-200\n              data-[state=active]:bg-white data-[state=active]:text-blue-600 data-[state=active]:shadow-md",children:[e.isDefault&&(0,s.jsx)("div",{className:"absolute -top-1 -right-1 bg-yellow-400 rounded-full p-0.5 shadow-md m-1",children:(0,s.jsx)(b.A,{className:"h-3 w-3 text-white"})}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(h.A,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:["Bank ",a+1]})]})]},"bank-tab-".concat(a)))}),O.length<3&&(0,s.jsxs)(C.$,{type:"button",variant:"outline",size:"sm",onClick:en,className:"flex items-center gap-1 border-blue-300 text-blue-600 hover:bg-blue-50 dark:hover:bg-zinc-700 hover:text-blue-700 transition-colors rounded-md shadow-sm bg-transparent",children:[(0,s.jsx)(x.A,{className:"h-4 w-4"})," Add Bank"]})]})}),O.map((e,a)=>(0,s.jsx)(T.av,{value:"bank-".concat(a),className:"space-y-6",children:(0,s.jsxs)(l.Zp,{className:"border-gray-200 rounded-lg overflow-hidden shadow-lg border-0 bg-white/80 backdrop-blur",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 p-4 border-b border-blue-100",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("h3",{className:"font-medium text-blue-800 flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"h-5 w-5 text-blue-600"}),"Bank ",a+1," Details"]}),e.isDefault&&(0,s.jsxs)(q.E,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200 shadow-sm",children:[(0,s.jsx)(b.A,{className:"h-3 w-3 mr-1 text-yellow-500"})," Default"]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[!e.isDefault&&(0,s.jsxs)(C.$,{type:"button",variant:"outline",size:"sm",onClick:()=>eo(a),className:"flex items-center gap-1 text-yellow-600 border-yellow-300 hover:bg-yellow-50 transition-colors",children:[(0,s.jsx)(b.A,{className:"h-4 w-4"})," Set as Default"]}),O.length>1&&!e.isDefault&&(0,s.jsxs)(C.$,{type:"button",variant:"outline",size:"sm",onClick:()=>ei(a),className:"flex items-center gap-1 text-red-600 border-red-300 hover:bg-red-50 transition-colors",children:[(0,s.jsx)(p.A,{className:"h-4 w-4"})," Remove"]})]})]})}),(0,s.jsx)(l.Wu,{className:"p-6",children:(0,s.jsx)(I.lV,{...ea,children:(0,s.jsxs)("form",{onSubmit:ea.handleSubmit(ec),className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 flex flex-row items-center justify-between py-3 px-4 border-b border-gray-200 rounded-md",children:[(0,s.jsxs)("h3",{className:"font-medium text-gray-800 mb-1 flex items-center gap-2",children:[(0,s.jsx)(g.A,{className:"h-5 w-5"})," Option 1: Fill Bank Details"]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Complete all fields below"})]}),(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,s.jsx)(I.zB,{control:ea.control,name:"bankName",render:e=>{let{field:a}=e;return(0,s.jsxs)(I.eI,{className:"space-y-2 transition-all duration-200 hover:shadow-sm rounded-md p-2",children:[(0,s.jsxs)(I.lR,{className:"flex items-center gap-1.5",children:[(0,s.jsx)(h.A,{className:"h-4 w-4 text-blue-600"})," Bank Name"," ",(0,s.jsx)("span",{className:"text-red-500 font-bold text-lg",children:"*"})]}),(0,s.jsx)(I.MJ,{children:(0,s.jsx)(S.p,{placeholder:"e.g., State Bank of India",...a,className:"border-blue-200 focus:border-blue-400 transition-colors"})}),(0,s.jsx)(I.C5,{})]})}}),(0,s.jsx)(I.zB,{control:ea.control,name:"bankAddress",render:e=>{let{field:a}=e;return(0,s.jsxs)(I.eI,{className:"space-y-2 transition-all duration-200 hover:shadow-sm rounded-md p-2",children:[(0,s.jsxs)(I.lR,{className:"flex items-center gap-1.5",children:[(0,s.jsx)(m.A,{className:"h-4 w-4 text-blue-600"})," Bank Address"," ",(0,s.jsx)("span",{className:"text-red-500 font-bold text-lg",children:"*"})]}),(0,s.jsx)(I.MJ,{children:(0,s.jsx)(S.p,{placeholder:"Branch address",...a,className:"border-blue-200 focus:border-blue-400 transition-colors"})}),(0,s.jsx)(I.C5,{})]})}})]}),(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,s.jsx)(I.zB,{control:ea.control,name:"accountNumber",render:e=>{let{field:a}=e;return(0,s.jsxs)(I.eI,{className:"space-y-2 transition-all duration-200 hover:shadow-sm rounded-md p-2",children:[(0,s.jsxs)(I.lR,{className:"flex items-center gap-1.5",children:[(0,s.jsx)(v.A,{className:"h-4 w-4 text-blue-600"})," Account Number"," ",(0,s.jsx)("span",{className:"text-red-500 font-bold text-lg",children:"*"})]}),(0,s.jsx)(I.MJ,{children:(0,s.jsx)(S.p,{placeholder:"Enter your account number",...a,className:"border-blue-200 focus:border-blue-400 transition-colors"})}),(0,s.jsx)(I.C5,{})]})}}),(0,s.jsx)(I.zB,{control:ea.control,name:"micrNumber",render:e=>{let{field:a}=e;return(0,s.jsxs)(I.eI,{className:"space-y-2 transition-all duration-200 hover:shadow-sm rounded-md p-2",children:[(0,s.jsxs)(I.lR,{className:"flex items-center gap-1.5",children:[(0,s.jsx)(N.A,{className:"h-4 w-4 text-blue-600"})," MICR Number"," ",(0,s.jsx)("span",{className:"text-red-500 font-bold text-lg",children:"*"})]}),(0,s.jsx)(I.MJ,{children:(0,s.jsx)(S.p,{placeholder:"9-digit MICR code",...a,maxLength:9,className:"border-blue-200 focus:border-blue-400 transition-colors"})}),(0,s.jsx)(I.C5,{})]})}})]}),(0,s.jsx)(I.zB,{control:ea.control,name:"ifscCode",render:e=>{let{field:a}=e;return(0,s.jsxs)(I.eI,{className:"space-y-2 transition-all duration-200 hover:shadow-sm rounded-md p-2",children:[(0,s.jsxs)(I.lR,{className:"flex items-center gap-1.5",children:[(0,s.jsx)(y.A,{className:"h-4 w-4 text-blue-600"})," IFSC Code"," ",(0,s.jsx)("span",{className:"text-red-500 font-bold text-lg",children:"*"})]}),(0,s.jsx)(I.MJ,{children:(0,s.jsx)(S.p,{placeholder:"e.g., SBIN0123456",...a,onChange:e=>{let t=e.target.value.toUpperCase();a.onChange(t)},className:"border-blue-200 focus:border-blue-400 transition-colors"})}),(0,s.jsx)(I.Rr,{children:"11-character IFSC code of your bank branch"}),(0,s.jsx)(I.C5,{})]})}}),(0,s.jsx)(I.zB,{control:ea.control,name:"accountType",render:e=>{let{field:a}=e;return(0,s.jsxs)(I.eI,{className:"space-y-3 transition-all duration-200 hover:shadow-sm rounded-md p-2",children:[(0,s.jsxs)(I.lR,{className:"flex items-center gap-1.5",children:[(0,s.jsx)(v.A,{className:"h-4 w-4 text-blue-600"})," Account Type"," ",(0,s.jsx)("span",{className:"text-red-500 font-bold text-lg",children:"*"})]}),(0,s.jsx)(I.MJ,{children:(0,s.jsxs)(B.z,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:[(0,s.jsxs)(I.eI,{className:"flex items-center space-x-2 space-y-0 rounded-md border border-blue-100 p-3 hover:bg-blue-50 transition-colors",children:[(0,s.jsx)(I.MJ,{children:(0,s.jsx)(B.C,{value:"Saving"})}),(0,s.jsx)(I.lR,{className:"font-normal cursor-pointer",children:"Savings"})]}),(0,s.jsxs)(I.eI,{className:"flex items-center space-x-2 space-y-0 rounded-md border border-blue-100 p-3 hover:bg-blue-50 transition-colors",children:[(0,s.jsx)(I.MJ,{children:(0,s.jsx)(B.C,{value:"Current"})}),(0,s.jsx)(I.lR,{className:"font-normal cursor-pointer",children:"Current"})]}),(0,s.jsxs)(I.eI,{className:"flex items-center space-x-2 space-y-0 rounded-md border border-blue-100 p-3 hover:bg-blue-50 transition-colors",children:[(0,s.jsx)(I.MJ,{children:(0,s.jsx)(B.C,{value:"Cash Credit"})}),(0,s.jsx)(I.lR,{className:"font-normal cursor-pointer",children:"Cash Credit / Overdraft"})]})]})}),(0,s.jsx)(I.C5,{})]})}}),(0,s.jsx)(A.w,{className:"my-6"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 flex flex-row items-center justify-between py-3 px-4 border-b border-gray-200 rounded-md",children:[(0,s.jsxs)("h3",{className:"font-medium text-gray-800 mb-1 flex items-center gap-2",children:[(0,s.jsx)(g.A,{className:"h-5 w-5"})," Option 2: Upload Cancelled Cheque"]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Upload a cancelled cheque instead of filling the form"})]}),(0,s.jsx)("div",{className:"border-2 border-dashed border-green-200 rounded-lg p-6 text-center hover:bg-green-50 transition-colors cursor-pointer relative",children:L[eb()]?(0,s.jsxs)("div",{className:"relative",children:["pdf"===L[eb()]?(0,s.jsx)("div",{className:"flex items-center justify-center bg-green-100 rounded p-4",children:(0,s.jsx)("p",{className:"text-sm font-medium text-green-700",children:"PDF Document"})}):(0,s.jsxs)("div",{className:"relative h-48",children:[(0,s.jsx)(R.default,{src:L[eb()]||"/placeholder.svg",alt:"Cheque preview",className:"w-full h-full object-contain rounded",fill:!0,style:{objectFit:"contain"}}),(0,s.jsx)("div",{className:"absolute inset-0 bg-green-500 bg-opacity-10 rounded"})]}),(0,s.jsx)(C.$,{type:"button",onClick:ef,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 shadow-md hover:bg-red-600 transition-colors",children:(0,s.jsx)(k.A,{className:"h-4 w-4"})})]}):(0,s.jsxs)("label",{htmlFor:"cheque-upload-".concat(eb()),className:"cursor-pointer flex flex-col items-center",children:[(0,s.jsx)("div",{className:"bg-green-100 p-3 rounded-full mb-3",children:(0,s.jsx)(j.A,{className:"h-6 w-6 text-green-600"})}),(0,s.jsx)("p",{className:"text-sm font-medium text-green-700",children:"Click to upload or drag and drop"}),(0,s.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"JPG, PNG or PDF (max. 5MB)"}),(0,s.jsx)("input",{id:"cheque-upload-".concat(eb()),type:"file",className:"hidden",accept:".jpg,.jpeg,.png,.pdf",onChange:em})]})}),(0,s.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"Upload a cancelled cheque leaf for verification"})]})]})})})]})},"bank-content-".concat(a)))]}),(0,s.jsxs)(J.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"flex justify-between items-center",children:[(0,s.jsx)(z.j,{variant:"ghost"}),(0,s.jsx)(C.$,{type:"button",onClick:()=>{er(),setTimeout(()=>{let e=O.filter(es);if(e.length>0&&!e.some(e=>e.isDefault)){G({title:"Validation Error",description:"Please set one bank as default.",variant:"destructive"});return}ea.handleSubmit(ec,e=>{console.error("Validation errors",e),G({title:"Validation Error",description:"Some fields are incomplete. Please check and try again.",variant:"destructive"})})()},100)},className:"w-full sm:w-auto px-6 py-2.5 text-base font-medium bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-600 shadow-md hover:shadow-lg transition-all duration-200 rounded-md",disabled:t,children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):(0,s.jsxs)("div",{className:"flex items-center",children:["Save & Continue ",(0,s.jsx)(w.A,{className:"ml-1 h-5 w-5"})]})})]}),(0,s.jsx)(_.lG,{open:o,onOpenChange:d,children:(0,s.jsxs)(_.Cf,{className:"max-w-2xl",children:[(0,s.jsxs)(_.c7,{children:[(0,s.jsxs)(_.L3,{className:"text-xl flex items-center gap-2",children:[(0,s.jsx)(g.A,{className:"h-5 w-5 text-green-500"})," Confirm Bank Details"]}),(0,s.jsx)(_.rr,{children:"Please verify that your bank details are correct. These details will be used for all financial transactions."})]}),(0,s.jsx)("div",{className:"py-4 space-y-6 text-sm max-h-[60vh] overflow-y-auto",children:O.filter(es).map((e,a)=>(0,s.jsxs)("div",{className:"rounded-lg border p-4 mb-4 ".concat(e.isDefault?"border-yellow-200 shadow-md":"border-gray-200 shadow-sm"),children:[(0,s.jsx)("div",{className:"border-b pb-2 bg-gradient-to-r rounded-t-md mb-3 px-2",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("h4",{className:"text-base font-semibold flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"h-5 w-5 text-blue-600"})," Bank ",a+1]}),e.isDefault&&(0,s.jsxs)("span",{className:"inline-flex items-center text-xs font-medium bg-yellow-50 text-yellow-700 border border-yellow-200 px-2 py-1 rounded my-2",children:[(0,s.jsx)(b.A,{className:"h-3 w-3 mr-1 text-yellow-500"})," Default"]})]})}),(0,s.jsxs)("div",{className:"space-y-3 text-sm",children:[L[a]&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("div",{className:"text-gray-500 font-medium",children:"Verification Method:"}),(0,s.jsxs)("div",{className:"font-medium text-green-600 flex items-center gap-1",children:[(0,s.jsx)(g.A,{className:"h-4 w-4"})," Cancelled Cheque"]})]}),e.bankName&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("div",{className:"text-gray-500 font-medium",children:"Bank Name:"}),(0,s.jsx)("div",{className:"font-medium",children:e.bankName})]}),e.bankAddress&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("div",{className:"text-gray-500 font-medium",children:"Bank Address:"}),(0,s.jsx)("div",{className:"font-medium",children:e.bankAddress})]}),e.accountNumber&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("div",{className:"text-gray-500 font-medium",children:"Account Number:"}),(0,s.jsx)("div",{className:"font-medium",children:"â€¢".repeat(e.accountNumber.length-4)+e.accountNumber.slice(-4)})]}),e.micrNumber&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("div",{className:"text-gray-500 font-medium",children:"MICR Number:"}),(0,s.jsx)("div",{className:"font-medium",children:e.micrNumber})]}),e.ifscCode&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("div",{className:"text-gray-500 font-medium",children:"IFSC Code:"}),(0,s.jsx)("div",{className:"font-medium",children:e.ifscCode})]}),e.accountType&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("div",{className:"text-gray-500 font-medium",children:"Account Type:"}),(0,s.jsx)("div",{className:"font-medium",children:eh(e.accountType)})]})]})]},"confirm-bank-".concat(a)))}),(0,s.jsxs)(_.Es,{children:[(0,s.jsx)(C.$,{variant:"outline",onClick:()=>d(!1),children:"Edit Details"}),(0,s.jsxs)(C.$,{onClick:eu,className:"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-600",disabled:t,children:[(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Confirm & Continue"]})]})]})})]}):(0,s.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}function P(){let{setCurrentStep:e,canAccessStep:a,handleDigioReturn:t,updateStepStatus:d,state:c,showBankConfirmation:u,setShowBankConfirmation:m,pendingNavigation:f,setPendingNavigation:b,validateStepStatuses:h}=(0,i.b)(),[x,p]=(0,r.useState)(!1);return(0,n.useSearchParams)(),(0,n.useRouter)(),(0,r.useEffect)(()=>{e("bank")},[e]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.A,{}),(0,s.jsx)(l.Zp,{className:"border-none shadow-md",children:(0,s.jsx)(l.Wu,{className:"pt-6 px-6 pb-8",children:(0,s.jsx)(O,{onFormSubmitted:()=>p(!0)})})})]})}},27685:(e,a,t)=>{"use strict";t.d(a,{j:()=>d});var s=t(95155),r=t(87364),l=t(73312),n=t(24672),i=t(76046),o=t(27461);function d(e){var a;let{className:t="",variant:d="outline",size:c="default",disabled:u=!1,type:m="button"}=e,{navigateToPreviousStep:f,getPreviousStep:b}=(0,n.b)(),{setErrors:h}=(0,o.Z)(),x=(null===(a=(0,i.usePathname)().split("/").pop())||void 0===a?void 0:a.replace(".html",""))||"",p=b(x);return p&&"signin"!==x?(0,s.jsxs)(l.$,{type:m,variant:d,size:c,onClick:()=>{u||(f(),h([]))},disabled:u,className:"flex items-center gap-2 ".concat(t),children:[(0,s.jsx)(r.A,{className:"h-4 w-4"}),"Back to ",p.replace("-"," ")]}):null}},25121:(e,a,t)=>{"use strict";t.d(a,{E:()=>i});var s=t(95155);t(12115);var r=t(31027),l=t(21567);let n=(0,r.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:a,variant:t,...r}=e;return(0,s.jsx)("div",{className:(0,l.cn)(n({variant:t}),a),...r})}},51344:(e,a,t)=>{"use strict";t.d(a,{Cf:()=>m,Es:()=>b,L3:()=>h,c7:()=>f,lG:()=>o,rr:()=>x,zM:()=>d});var s=t(95155),r=t(12115),l=t(10164),n=t(40767),i=t(21567);let o=l.bL,d=l.l9,c=l.ZL;l.bm;let u=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.hJ,{ref:a,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});u.displayName=l.hJ.displayName;let m=r.forwardRef((e,a)=>{let{className:t,children:r,...o}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(u,{}),(0,s.jsxs)(l.UC,{ref:a,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...o,children:[r,(0,s.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(n.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.UC.displayName;let f=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...t})};f.displayName="DialogHeader";let b=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};b.displayName="DialogFooter";let h=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.hE,{ref:a,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})});h.displayName=l.hE.displayName;let x=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.VY,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",t),...r})});x.displayName=l.VY.displayName},33900:(e,a,t)=>{"use strict";t.d(a,{p:()=>n});var s=t(95155),r=t(12115),l=t(21567);let n=r.forwardRef((e,a)=>{let{className:t,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:(0,l.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...n})});n.displayName="Input"},84179:(e,a,t)=>{"use strict";t.d(a,{C:()=>d,z:()=>o});var s=t(95155),r=t(12115),l=t(852),n=t(33565),i=t(21567);let o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.bL,{className:(0,i.cn)("grid gap-2",t),...r,ref:a})});o.displayName=l.bL.displayName;let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.q7,{ref:a,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:(0,s.jsx)(l.C1,{className:"flex items-center justify-center",children:(0,s.jsx)(n.A,{className:"h-3.5 w-3.5 fill-primary"})})})});d.displayName=l.q7.displayName},15157:(e,a,t)=>{"use strict";t.d(a,{w:()=>i});var s=t(95155),r=t(12115),l=t(90434),n=t(21567);let i=r.forwardRef((e,a)=>{let{className:t,orientation:r="horizontal",decorative:i=!0,...o}=e;return(0,s.jsx)(l.b,{ref:a,decorative:i,orientation:r,className:(0,n.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",t),...o})});i.displayName=l.b.displayName},62884:(e,a,t)=>{"use strict";t.d(a,{Xi:()=>d,av:()=>c,j7:()=>o,tU:()=>i});var s=t(95155),r=t(12115),l=t(58629),n=t(21567);let i=l.bL,o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.B8,{ref:a,className:(0,n.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...r})});o.displayName=l.B8.displayName;let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.l9,{ref:a,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...r})});d.displayName=l.l9.displayName;let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.UC,{ref:a,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r})});c.displayName=l.UC.displayName}},e=>{var a=a=>e(e.s=a);e.O(0,[1181,8526,8562,164,2589,8007,5565,7518,5427,6678,5662,6137,4672,9741,8441,1517,7358],()=>a(18629)),_N_E=e.O()}]);